System.register("chunks:///_virtual/EventCenter.ts",["./_rollupPluginModLoBabelHelpers.js","cc"],(function(e){"use strict";var n,t,o;return{setters:[function(e){n=e.defineProperty},function(e){t=e.cclegacy,o=e.EventTarget}],execute:function(){t._RF.push({},"1b89bgsM1ZAUaiO1R2FAmwU","EventCenter",void 0);var c=new o,r=e("EventCenter",function(){function e(){}return e.on=function(e,n,t){c.on(e,n,t)},e.off=function(e,n,t){c.on(e,n,t)},e.emit=function(e,n){c.emit(e,n)},e}());n(r,"GOLD",100),n(r,"HP",100),n(r,"SPEED_TIMES",2),n(r,"GOLD_CHANGE","gold_change"),n(r,"SPEED_CHANGE","speed_change"),t._RF.pop()}}}));

System.register("chunks:///_virtual/MonsterController.ts",["./_rollupPluginModLoBabelHelpers.js","cc","./EventCenter.ts","./GameState.ts","./GameManager.ts"],(function(t){"use strict";var e,o,i,s,n,r,a,h,u,c,d,_,m,l,g,p,R;return{setters:[function(t){e=t.applyDecoratedDescriptor,o=t.inheritsLoose,i=t.defineProperty,s=t.assertThisInitialized,n=t.initializerDefineProperty,r=t.createForOfIteratorHelperLoose},function(t){a=t.cclegacy,h=t._decorator,u=t.Node,c=t.SkeletalAnimation,d=t.Vec3,_=t.Collider,m=t.Quat,l=t.Component},function(t){g=t.EventCenter},function(t){p=t.GameState},function(t){R=t.GameManager}],execute:function(){var f,P,y,S,T,E,C;a._RF.push({},"1da620uiadD8Ze/GQQkpHSR","MonsterController",void 0);var M=h.ccclass,b=h.property;t("MonsterController",(f=M("MonsterController"),P=b({type:u}),y=b({type:c}),f((E=e((T=function(t){function e(){for(var e,o=arguments.length,r=new Array(o),a=0;a<o;a++)r[a]=arguments[a];return e=t.call.apply(t,[this].concat(r))||this,i(s(e),"_startJump",!1),i(s(e),"_startRot",!1),i(s(e),"_curJumpTime",0),i(s(e),"_curRoadTime",0),i(s(e),"_curRotTime",0),i(s(e),"_curPos",new d),i(s(e),"_deltaPos",new d(0,0,0)),i(s(e),"_targetPos",new d),i(s(e),"_targetBodyRot",new d),i(s(e),"_curXLong",void 0),i(s(e),"_curZLong",void 0),i(s(e),"_curRot",new d(0,0,0)),i(s(e),"_deltaRot",new d(0,0,0)),i(s(e),"_targetRot",new d),i(s(e),"curRoad",0),i(s(e),"roads",[[-.65,2],[-2,.85],[7.4,-4]]),i(s(e),"isDie",!1),i(s(e),"monsterInfo",{name:"",hp:0,speed:0,price:0}),i(s(e),"collider",null),n(s(e),"body",E,s(e)),n(s(e),"CocosAnim",C,s(e)),e}o(e,t);var a=e.prototype;return a.start=function(){for(var t,e=r(this.node.getParent().getComponent(R).monsters);!(t=e()).done;){var o=t.value;o.name==this.node.name.toLowerCase()&&(this.monsterInfo=Object.assign(this.monsterInfo,o))}this.node.setPosition(new d(-4.75,0,4.35)),this.gameStateChange(p.STATE),this.begin(),this.collider=this.node.children[0].getComponent(_),this.collider.on("onTriggerStay",this.onTriggerStay,this),g.on(g.SPEED_CHANGE,this.gameStateChange,this)},a.setData=function(){},a.gameStateChange=function(t){t==p.PLAYING?(this.CocosAnim.getState("run").speed=1,this.CocosAnim.getState("die").speed=1):t==p.SPEED&&(this.CocosAnim.getState("run").speed=g.SPEED_TIMES,this.CocosAnim.getState("die").speed=g.SPEED_TIMES)},a.onTriggerStay=function(t){var e=this;this.monsterInfo.hp-=1,this.monsterInfo.hp>0||this.monsterInfo.hp<0||(this.collider.off("onTriggerStay",this.onTriggerStay,this),this.CocosAnim.play("die"),g.GOLD+=this.monsterInfo.price,g.emit(g.GOLD_CHANGE,g.GOLD),setTimeout((function(){e.node&&e.node.destroy()}),900*this.CocosAnim.getState("die").duration))},a.begin=function(){this._startJump=!0,this._startRot=!0,this._curJumpTime=0,this.CocosAnim&&this.CocosAnim.play("run"),this.setRoadData(0)},a.setRoadData=function(t){this.node.getPosition(this._curPos),this._targetPos=new d(this.roads[t][0],0,this.roads[t][1]),this._curXLong=this._targetPos.x-this._curPos.x,this._curZLong=this._targetPos.z-this._curPos.z;var e=Math.abs(this._curXLong),o=Math.abs(this._curZLong),i=Math.sqrt(Math.pow(e,2)+Math.pow(o,2));this._curRoadTime=i/this.monsterInfo.speed;var s=m.toEuler(this.node.getPosition(),this.node.getRotation());this._curRot=new d(s.x,s.y,s.z),this._targetRot=this.calcNodeRot(this._curRot,this._curPos,this._targetPos)},a.calcNodeRot=function(t,e,o){var i=Math.atan2(e.z-o.z,o.x-e.x),s=i*(180/Math.PI);return this._curRotTime=Math.abs(Math.abs(t.y)-Math.abs(s))/180,this._targetBodyRot=new d(45*Math.sin(i),90,-45*Math.cos(i)),new d(0,s,0)},a.onOnceJumpEnd=function(){if(this.curRoad<this.roads.length-1)return this.curRoad+=1,this._curJumpTime=0,this._curRotTime=0,this.setRoadData(this.curRoad),void(this._startRot=!0);this._startJump=!1,this.curRoad=0,this.node.getParent().getComponent(R).subHP(this.monsterInfo.hp),this.node.destroy()},a.update=function(t){if(0!=this.monsterInfo.hp&&(p.STATE==p.SPEED&&(t*=g.SPEED_TIMES),this._startJump&&(this._curJumpTime+=t,this._curJumpTime>this._curRoadTime?(this.node.setPosition(this._targetPos),this.onOnceJumpEnd()):(this.node.getPosition(this._curPos),this._deltaPos.x=t*this._curXLong/this._curRoadTime,this._deltaPos.z=t*this._curZLong/this._curRoadTime,d.add(this._curPos,this._curPos,this._deltaPos),this.node.setPosition(this._curPos))),this._startRot))if(this._curJumpTime>this._curRotTime)this.body.setRotationFromEuler(this._targetBodyRot),this.node.setRotationFromEuler(this._targetRot),this._startRot=!1;else{this._deltaRot.y=(this._curRot.y>this._targetRot.y?-1:1)*t*180,d.add(this._curRot,this._curRot,this._deltaRot),this.node.setRotationFromEuler(this._curRot);var e=this._curRot.y*Math.PI/180;e=Number(e.toFixed(2)),this.body.setRotationFromEuler(new d(45*Math.sin(e),90,-45*Math.cos(e)))}},e}(l)).prototype,"body",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),C=e(T.prototype,"CocosAnim",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),S=T))||S));a._RF.pop()}}}));

System.register("chunks:///_virtual/HomeManager.ts",["./_rollupPluginModLoBabelHelpers.js","cc","./HttpRequest.ts"],(function(e){"use strict";var n,o,t,r,s,c,i;return{setters:[function(e){n=e.inheritsLoose,o=e.defineProperty,t=e.assertThisInitialized},function(e){r=e.cclegacy,s=e._decorator,c=e.Component},function(e){i=e.HttpRequest}],execute:function(){var u;r._RF.push({},"3c9eeGECU5IQKjmJS+Ft+GT","HomeManager",void 0);var f=s.ccclass;s.property,e("HomeManager",f("HomeManager")(u=function(e){function r(){for(var n,r=arguments.length,s=new Array(r),c=0;c<r;c++)s[c]=arguments[c];return n=e.call.apply(e,[this].concat(s))||this,o(t(n),"gameService",void 0),o(t(n),"userInfo",void 0),n}n(r,e);var s=r.prototype;return s.start=function(){wx.login({success:function(e){i.POST("/user/loginByWeixin",e).then((function(e){console.log("userInfo"),console.log(e),i.SetToken(e)}))}})},s.getRoom=function(e){this.gameService.getRoomInfo().then((function(e){console.log(e)}))},s.authorizeUserInfo=function(){var e=this;wx.authorize({scope:"scope.userInfo",success:function(){wx.getUserInfo({success:function(n){i.POST("/user/setUserInfo",n.userInfo).then((function(n){e.getUserInfo()}))},fail:function(e){console.log(e)}})}})},s.getUserInfo=function(){var e=this;i.POST("/user/getCurrentUserInfo").then((function(n){e.userInfo=n}))},r}(c))||u);r._RF.pop()}}}));

System.register("chunks:///_virtual/UIManager.ts",["./_rollupPluginModLoBabelHelpers.js","cc","./EventCenter.ts","./Player.ts"],(function(e){"use strict";var t,r,n,i,a,o,l,s,c,u,p,g,m,f,y,h,d,b,v,C,P,w,M,z,N,T,_,x,B;return{setters:[function(e){t=e.applyDecoratedDescriptor,r=e.inheritsLoose,n=e.initializerDefineProperty,i=e.assertThisInitialized,a=e.defineProperty,o=e.createForOfIteratorHelperLoose},function(e){l=e.cclegacy,s=e._decorator,c=e.Node,u=e.Label,p=e.Prefab,g=e.Camera,m=e.geometry,f=e.BoxCollider,y=e.instantiate,h=e.Sprite,d=e.Widget,b=e.assetManager,v=e.SpriteFrame,C=e.Texture2D,P=e.PhysicsSystem,w=e.Vec3,M=e.director,z=e.Color,N=e.view,T=e.UITransform,_=e.Component},function(e){x=e.EventCenter},function(e){B=e.Player}],execute:function(){var D,L,O,S,E,R,U,A,G,I,k,H,V,X,Y,j,q,F,J,K,Q,W,Z;l._RF.push({},"40099MQa/lKfJkXNiIsoqvv","UIManager",void 0);var $=s.ccclass,ee=s.property;e("UIManager",(D=$("UIManager"),L=ee({type:c}),O=ee({type:c}),S=ee({type:c}),E=ee(u),R=ee({type:p}),U=ee({type:p}),A=ee({type:p}),G=ee(g),I=ee(g),k=ee(c),D((X=t((V=function(e){function t(){for(var t,r=arguments.length,o=new Array(r),l=0;l<r;l++)o[l]=arguments[l];return t=e.call.apply(e,[this].concat(o))||this,n(i(t),"rightMenu",X,i(t)),n(i(t),"leftMenu",Y,i(t)),n(i(t),"playerBox",j,i(t)),n(i(t),"centerName",q,i(t)),n(i(t),"itemPrefab",F,i(t)),n(i(t),"playerPrefab",J,i(t)),n(i(t),"bingnvPrefab",K,i(t)),n(i(t),"cameraCom",Q,i(t)),n(i(t),"canvasCom",W,i(t)),n(i(t),"targetNode",Z,i(t)),a(i(t),"players",void 0),a(i(t),"_ray",new m.Ray),t}r(t,e);var l=t.prototype;return l.start=function(){this.customWindows(),this.getPlayers();for(var e,t=o(this.targetNode.children);!(e=t()).done;){var r=e.value;r.getComponent(f).setGroup(2),r.getComponent(f).setMask(2)}},l.getPlayers=function(){var e=[{name:"player",label:"精灵射手",price:100,image:"https://im.live.360.cn:8989/uploads/QK1kFaGWEVkqoa4AEj37Tv59IwM.jpg?e=20240411T082414&s=E_pmLi-bAtAKPq-1OnooBwiXOqZdUwfMtshvXujSVW8",description:"基础远程单位",range:3,skills:[{name:"range",label:"范围射击",image:"https://im.live.360.cn:8989/uploads/LS1qDpBb6OhtjLn0AH0wRa2m5uD.png?e=20240407T064648&s=XrSqs0KGWAYs1jeJDzOzI8dQix1e-kUcT9jqYfERD4M",description:"增加攻击范围",value:1.1,price:100},{name:"speed",label:"加速射击",image:"https://im.live.360.cn:8989/uploads/tXYoMueyLFMGaSrPfc45ztzkxSJ.png?e=20240411T074734&s=IKBl8NZozoJ17zaRmBa3HmVmBqYJ7ADnAyxMBK9_piQ",description:"增加攻击速度",value:1.1,price:100}]},{name:"bingnv",label:"冰霜女巫",price:200,image:"https://im.live.360.cn:8989/uploads/0YVBdQMtg2vnAv7pgvXjmwCtUew.png?e=20240411T184530&s=idkBnu_s_vQEMR-rdh592s1YDJ8mRtPJZU7y-z7O9oA",description:"魔法远程单位",range:4,skills:[]}];this.players=e,this.centerName.string=e[0].label;for(var t=0;t<this.players.length;t++)this.setPlayer(this.players[t],t);this.goldChange(x.GOLD),x.on(x.GOLD_CHANGE,this.goldChange,this)},l.setPlayer=function(e,t){var r=this,n=y(this.itemPrefab);this.playerBox.addChild(n),n.getChildByName("PlayerDraw").getComponent(h).spriteFrame,n.getChildByName("GoldNumber").getComponent(u).string="$"+e.price,n.getComponent(d).top=130*parseInt(t/2+""),n.getComponent(d).left=t%2*100,b.loadRemote(e.image,(function(e,t){var r=new v,i=new C;i.image=t,r.texture=i,n.getChildByName("PlayerDraw").getComponent(h).spriteFrame=r}));var i=n.getChildByName("PlayerPlane");i.on(c.EventType.TOUCH_START,(function(t){if(r.centerName.string=e.label,x.GOLD<e.price)return;i.on(c.EventType.TOUCH_MOVE,o,r),i.setScale(50,50);var n=t.touch;r.cameraCom.screenPointToRay(n.getLocationX(),n.getLocationY(),r._ray)}),this),i.on(c.EventType.TOUCH_END,(function(t){if(x.GOLD<e.price)return;i.off(c.EventType.TOUCH_MOVE,o,r),i.setScale(1,1);var n=t.touch;if(!a)return;if(r.cameraCom.screenPointToRay(n.getLocationX(),n.getLocationY(),r._ray),!P.instance.raycast(r._ray))return a&&a.destroy(),void(a=null);for(var l=P.instance.raycastResults,s=!1,u=0;u<l.length;u++)l[u].collider.node==r.targetNode&&(s=!0);if(!s)return a.destroy(),void(a=null);a&&(a.getComponent(B).begin(),a=null)}),this);var a=null;function o(t){if(!(x.GOLD<e.price)){var n=t.touch;if(r.cameraCom.screenPointToRay(n.getLocationX(),n.getLocationY(),r._ray),P.instance.raycast(r._ray)){for(var i=P.instance.raycastResults,o=0;o<i.length;o++)if(i[o].collider.node==r.targetNode){var l=i[o].hitPoint;if(a)a.setPosition(new w(l.x,0,l.z));else{(a=y(r[e.name+"Prefab"])).setParent(M.getScene()),a.getComponent(B).setData(e);var s=i[0].hitPoint;a.setPosition(new w(s.x,0,s.z))}return}a&&(a.destroy(),a=null)}}}},l.goldChange=function(e){for(var t=0;t<this.players.length;t++){var r=this.playerBox.children[t].getChildByName("GoldNumber").getComponent(u);this.players[t].price>e?r.color=new z("#ff3141"):r.color=new z("#ffffff")}},l.customWindows=function(){var e=N.getVisibleSize().width,t=N.getVisibleSize().height,r=t/10,n=this.rightMenu.getComponent(T).width,i=this.leftMenu.getComponent(T).width+this.leftMenu.getPosition().x;e/t<=16/9&&(i=0,this.leftMenu.destroy());var a=e-i-n,o=e/2/r,l=i/r+a/2/r,s=this.cameraCom.node.getPosition();s.x=s.x+(o-l),this.cameraCom.node.setPosition(s);var c=this.targetNode.getScale().x*t;c<a&&(s.y=12.07/a*c*.96,s.x=s.x/12.07*s.y,this.cameraCom.node.setPosition(s))},t}(_)).prototype,"rightMenu",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Y=t(V.prototype,"leftMenu",[O],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),j=t(V.prototype,"playerBox",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),q=t(V.prototype,"centerName",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),F=t(V.prototype,"itemPrefab",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),J=t(V.prototype,"playerPrefab",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),K=t(V.prototype,"bingnvPrefab",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Q=t(V.prototype,"cameraCom",[G],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),W=t(V.prototype,"canvasCom",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Z=t(V.prototype,"targetNode",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),H=V))||H));l._RF.pop()}}}));

System.register("chunks:///_virtual/BulletController.ts",["./_rollupPluginModLoBabelHelpers.js","cc"],(function(t){"use strict";var o,s,e,i,n,r,a,h,c;return{setters:[function(t){o=t.inheritsLoose,s=t.defineProperty,e=t.assertThisInitialized},function(t){i=t.cclegacy,n=t._decorator,r=t.Quat,a=t.Vec3,h=t.BoxCollider,c=t.Component}],execute:function(){var l;i._RF.push({},"7e92dQhrRNJ8a2eSfcFgRi3","BulletController",void 0);var u=n.ccclass;n.property,t("BulletController",u("BulletController")(l=function(t){function i(){for(var o,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return o=t.call.apply(t,[this].concat(n))||this,s(e(o),"_curPos",new a),s(e(o),"_targetPos",new a),s(e(o),"_deltaPos",new a(0,0,0)),s(e(o),"XLong",0),s(e(o),"ZLong",0),s(e(o),"attackLong",2),s(e(o),"speed",o.attackLong/.3),s(e(o),"time",0),o}o(i,t);var n=i.prototype;return n.start=function(){this._curPos=this.node.getPosition();var t=r.toEuler(this.node.getPosition(),this.node.getRotation()).y*Math.PI/180,o=this._curPos.x+this.attackLong*Math.cos(t),s=this._curPos.z-this.attackLong*Math.sin(t);this._targetPos=new a(o,this._curPos.y,s),this.XLong=o-this._curPos.x,this.ZLong=s-this._curPos.z,this.node.getComponent(h).on("onTriggerStay",this.onTriggerStay,this)},n.onTriggerStay=function(t){this.node.destroy()},n.update=function(t){this.time+=t,this.time<this.attackLong/this.speed?(this._deltaPos.x=this.XLong*this.speed*t,this._deltaPos.z=this.ZLong*this.speed*t,a.add(this._curPos,this._curPos,this._deltaPos),this.node.setPosition(this._curPos)):this.node.destroy()},i}(c))||l);i._RF.pop()}}}));

System.register("chunks:///_virtual/Player.ts",["./_rollupPluginModLoBabelHelpers.js","cc","./EventCenter.ts","./MonsterController.ts"],(function(t){"use strict";var e,i,n,a,r,o,s,l,h,c,u,g,d,m,p,f,y,b,A,T,C,S,M,E,v;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,n=t.initializerDefineProperty,a=t.assertThisInitialized,r=t.defineProperty,o=t.createForOfIteratorHelperLoose},function(t){s=t.cclegacy,l=t._decorator,h=t.Node,c=t.SkeletalAnimation,u=t.Prefab,g=t.Material,d=t.AudioClip,m=t.Vec3,p=t.AudioSource,f=t.Animation,y=t.Collider,b=t.director,A=t.MeshRenderer,T=t.Quat,C=t.macro,S=t.instantiate,M=t.Component},function(t){E=t.EventCenter},function(t){v=t.MonsterController}],execute:function(){var P,k,w,N,R,I,z,G,x,D,L,K,_,B,O,F,H;s._RF.push({},"943084iGwtLuofdpC+l6lB+","Player",void 0);var j,V=l.ccclass,q=l.property;!function(t){t.PLACE="revive",t.IDLE="idle",t.ATTACKING="attack",t.ATTACKED="attacked"}(j||(j={}));t("Player",(P=V("Player"),k=q({type:h}),w=q({type:c}),N=q({type:u}),R=q({type:g}),I=q({type:g}),z=q(d),G=q(d),P((L=e((D=function(t){function e(){for(var e,i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];return e=t.call.apply(t,[this].concat(o))||this,n(a(e),"body",L,a(e)),n(a(e),"CocosAnim",K,a(e)),n(a(e),"bullet",_,a(e)),n(a(e),"errorMaterial",B,a(e)),n(a(e),"successMaterial",O,a(e)),r(a(e),"audioSource",null),r(a(e),"animation",null),n(a(e),"bow",F,a(e)),n(a(e),"arrow",H,a(e)),r(a(e),"gameManager",null),r(a(e),"playerState",j.PLACE),r(a(e),"lastMonster",null),r(a(e),"attackRange",3),r(a(e),"attackTime",0),r(a(e),"triggerNumber",0),r(a(e),"collider",null),r(a(e),"range",null),r(a(e),"data",void 0),r(a(e),"_curPos",new m(0,0,0)),e}i(e,t);var s=e.prototype;return s.start=function(){this.audioSource=this.node.getComponent(p),this.animation=this.node.getComponent(f),this.collider=this.node.children[0].getComponent(y),this.collider.setGroup(2),this.collider.setMask(3),this.collider.on("onTriggerEnter",this.onTriggerEnter,this),this.collider.on("onTriggerExit",this.onTriggerExit,this),this.canSpace(0==this.triggerNumber)},s.onTriggerEnter=function(){this.triggerNumber+=1,this.canSpace(0==this.triggerNumber)},s.onTriggerExit=function(){this.triggerNumber-=1,this.canSpace(0==this.triggerNumber)},s.setData=function(t){this.data=Object.assign({},t),this.attackRange=t.range,this.range=this.node.getChildByName("range");var e=this.range.getScale();e.x=this.attackRange/5,e.z=this.attackRange/5*.8,this.range.setScale(e)},s.begin=function(){if(this.triggerNumber>=1)this.node.destroy();else{E.GOLD-=this.data.price,E.emit(E.GOLD_CHANGE,E.GOLD),this.audioSource.play(),this.animation.play(),this.collider.off("onTriggerEnter",this.onTriggerEnter,this),this.collider.off("onTriggerExit",this.onTriggerExit,this),this.changeState(j.IDLE),this._curPos=this.node.getPosition(),this.gameManager=b.getScene().getChildByName("GameManager");var t=this.node.getChildByName("range").getPosition();t.y=-.1,this.node.getChildByName("range").setPosition(t)}},s.showRange=function(t){var e=this.node.getChildByName("range").getPosition();e.y=t?.1:-.1,this.node.getChildByName("range").setPosition(e)},s.updateSkill=function(){for(var t,e=this.data,i=o(this.data.learned_skills);!(t=i()).done;){var n=t.value;if("range"==n.name){this.attackRange=e.range*n.value,this.range=this.node.getChildByName("range");var a=this.range.getScale();a.x=this.attackRange/5,a.z=this.attackRange/5*.8,this.range.setScale(a)}else"speed"==n.name||"attack"==n.name||"boom"==n.name||"ice"==n.name||"defense"==n.name||"coiled"==n.name||n.name}},s.canSpace=function(t){t?this.range.getComponent(A).setMaterial(this.successMaterial,0):this.range.getComponent(A).setMaterial(this.errorMaterial,0)},s.changeState=function(t){this.CocosAnim.play(t),this.playerState=t},s.getAnimationTime=function(t){return 1e3*this.CocosAnim.getState(t).duration},s.update=function(t){var e=this;if(this.playerState!=j.PLACE&&this.playerState!=j.ATTACKED&&this.gameManager.children&&this.gameManager.children.length){for(var i,n=null,a=null,r=o(this.gameManager.children);!(i=r()).done;){var s=i.value,l=g(s,this._curPos),h=s.getComponent(v);if(l<this.attackRange&&h.monsterInfo.hp>0&&this.lastMonster==s){n=s;break}l<this.attackRange&&h.monsterInfo.hp>0&&(null==a||a>l)&&(n=s,a=l)}if(n){this.attackTime+=t,this.lastMonster=n;var c=T.toEuler(this.node.getPosition(),this.node.getRotation());this.node.setRotationFromEuler(this.calcNodeRot(new m(c.x,c.y,c.z),this._curPos,n.getPosition())),this.playerState==j.IDLE&&(this.playerState=j.ATTACKING,this.CocosAnim.play(j.ATTACKING),this.beginAttack())}else if(this.playerState==j.ATTACKING){this.playerState=j.ATTACKED,this.lastMonster=null,this.unschedule(this.doAttack);var u=this.getAnimationTime(j.ATTACKING)-1e3*this.attackTime%this.getAnimationTime(j.ATTACKING);setTimeout((function(){e.changeState(j.IDLE)}),u)}}function g(t,e){if(!t.getPosition)return 99999;var i=t.getPosition(),n=Math.abs(i.x-e.x),a=Math.abs(i.z-e.z);return Math.sqrt(Math.pow(n,2)+Math.pow(a,2))}},s.calcNodeRot=function(t,e,i){var n=Math.atan2(e.z-i.z,i.x-e.x),a=n*(180/Math.PI);return this.body.setRotationFromEuler(new m(45*Math.sin(n),90,-45*Math.cos(n))),this.range.setRotationFromEuler(new m(0,-1*a,0)),new m(0,a,0)},s.beginAttack=function(){this.attackTime=0,this.bow&&this.audioSource.playOneShot(this.bow,.5),this.schedule(this.doAttack,this.getAnimationTime(j.ATTACKING)/1e3,C.REPEAT_FOREVER,2*this.getAnimationTime(j.ATTACKING)/3e3)},s.doAttack=function(){var t=S(this.bullet);t.setParent(b.getScene());var e=this.node.getPosition();t.setPosition(new m(e.x,t.getPosition().y,e.z)),t.setRotation(this.node.getRotation()),this.audioSource.playOneShot(this.arrow,1),setTimeout(function(){this.bow&&this.audioSource.playOneShot(this.bow,.5)}.bind(this),this.getAnimationTime(j.ATTACKING)/3)},e}(M)).prototype,"body",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),K=e(D.prototype,"CocosAnim",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_=e(D.prototype,"bullet",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),B=e(D.prototype,"errorMaterial",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),O=e(D.prototype,"successMaterial",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),F=e(D.prototype,"bow",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),H=e(D.prototype,"arrow",[G],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),x=D))||x));s._RF.pop()}}}));

System.register("chunks:///_virtual/GameManager.ts",["./_rollupPluginModLoBabelHelpers.js","cc","./EventCenter.ts","./GameState.ts"],(function(e){"use strict";var t,n,r,i,a,o,s,l,u,c,m,p,h,b,f,g;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,r=e.initializerDefineProperty,i=e.assertThisInitialized,a=e.defineProperty},function(e){o=e.cclegacy,s=e._decorator,l=e.Prefab,u=e.Camera,c=e.Node,m=e.Label,p=e.AudioSource,h=e.instantiate,b=e.Component},function(e){f=e.EventCenter},function(e){g=e.GameState}],execute:function(){var d,v,T,E,y,P,S,A,G,H,w,I,B,L,z,D,M,N,C,W,x,_,R;o._RF.push({},"e764c8ZiSRH/71CsrQHCzNy","GameManager",void 0);var U=s.ccclass,Y=s.property;e("GameManager",(d=U("GameManager"),v=Y({type:l}),T=Y({type:l}),E=Y({type:l}),y=Y(u),P=Y(c),S=Y(m),A=Y(m),G=Y(m),H=Y(m),w=Y(m),d((L=t((B=function(e){function t(){for(var t,n=arguments.length,o=new Array(n),s=0;s<n;s++)o[s]=arguments[s];return t=e.call.apply(e,[this].concat(o))||this,r(i(t),"monster",L,i(t)),r(i(t),"stone",z,i(t)),r(i(t),"playerPrefab",D,i(t)),r(i(t),"cameraCom",M,i(t)),r(i(t),"targetNode",N,i(t)),r(i(t),"WaveAll",C,i(t)),r(i(t),"WaveNumber",W,i(t)),r(i(t),"HPLabel",x,i(t)),r(i(t),"GoldLabel",_,i(t)),r(i(t),"BeginButton",R,i(t)),a(i(t),"monsters",void 0),a(i(t),"map",void 0),a(i(t),"currentWaveIndex",0),a(i(t),"currentMonsterIndex",0),a(i(t),"monsterTime",0),a(i(t),"HP",100),a(i(t),"isHalfTime",!1),t}n(t,e);var o=t.prototype;return o.start=function(){var e=this;this.monsters=[{name:"monster",title:"小火龙",price:50,hp:3,speed:1},{name:"stone",title:"石头人",price:500,hp:50,speed:.8}],this.map={waves:[{monsters:[{name:"monster",count:3,interval:3}]},{monsters:[{name:"monster",count:5,interval:3}]},{monsters:[{name:"monster",count:10,interval:2}]},{monsters:[{name:"monster",count:15,interval:2}]},{monsters:[{name:"monster",count:10,interval:2},{name:"stone",count:1,interval:1}]}]},this.WaveAll.string=this.map.waves.length+"",this.WaveNumber.string="1",f.on(f.GOLD_CHANGE,(function(t){e.GoldLabel.string=f.GOLD+""}),this)},o.onGameBegin=function(){this.node.getComponent(p).play(),g.STATE==g.PAUSED?(g.STATE=g.PLAYING,this.BeginButton.string="游戏中..."):g.STATE==g.PLAYING?(g.STATE=g.SPEED,this.BeginButton.string="加速中..."):g.STATE==g.SPEED&&(g.STATE=g.PLAYING,this.BeginButton.string="游戏中..."),f.emit(f.SPEED_CHANGE,g.STATE)},o.createMonster=function(e){var t=h(this[e]);this.node.addChild(t)},o.subHP=function(e){this.HP-=e,this.HPLabel.string=this.HP+""},o.update=function(e){if(g.STATE!=g.PAUSED)if(this.isHalfTime)this.node.children&&0!=this.node.children.length||(g.STATE=g.PAUSED,this.isHalfTime=!1,this.BeginButton.string="开始战斗");else if(g.STATE==g.SPEED&&(e*=f.SPEED_TIMES),!(this.currentWaveIndex>=this.map.waves.length)){this.monsterTime+=e;var t=this.map.waves[this.currentWaveIndex],n=t.monsters[this.currentMonsterIndex];this.WaveNumber.string=this.currentWaveIndex+1+"",this.monsterTime>=n.interval&&(this.monsterTime=0,n.count-=1,this.createMonster(n.name),n.count<=0&&(this.currentMonsterIndex+=1),this.currentMonsterIndex>=t.monsters.length&&(this.currentMonsterIndex=0,this.currentWaveIndex+=1,this.isHalfTime=!0))}},t}(b)).prototype,"monster",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=t(B.prototype,"stone",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),D=t(B.prototype,"playerPrefab",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),M=t(B.prototype,"cameraCom",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),N=t(B.prototype,"targetNode",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),C=t(B.prototype,"WaveAll",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),W=t(B.prototype,"WaveNumber",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),x=t(B.prototype,"HPLabel",[G],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_=t(B.prototype,"GoldLabel",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),R=t(B.prototype,"BeginButton",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I=B))||I));o._RF.pop()}}}));

System.register("chunks:///_virtual/InfoManager.ts",["./_rollupPluginModLoBabelHelpers.js","cc","./EventCenter.ts","./Player.ts"],(function(e){"use strict";var t,l,n,i,r,o,a,s,u,h,p,g,f,c,y,m,P,k,d,_,C,v,b;return{setters:[function(e){t=e.applyDecoratedDescriptor,l=e.inheritsLoose,n=e.initializerDefineProperty,i=e.assertThisInitialized,r=e.defineProperty,o=e.createForOfIteratorHelperLoose},function(e){a=e.cclegacy,s=e._decorator,u=e.Node,h=e.Camera,p=e.Sprite,g=e.Label,f=e.geometry,c=e.Animation,y=e.Widget,m=e.assetManager,P=e.SpriteFrame,k=e.Texture2D,d=e.Color,_=e.PhysicsSystem,C=e.Component},function(e){v=e.EventCenter},function(e){b=e.Player}],execute:function(){var w,S,I,T,A,B,L,R,D,M,N,z,F,x,E,O,G,H,U,j,q;a._RF.push({},"e7becqcKflECrv7onAAPnsB","InfoManager",void 0);var K=s.ccclass,W=s.property;e("InfoManager",(w=K("InfoManager"),S=W({type:u}),I=W({type:u}),T=W({type:u}),A=W({type:u}),B=W({type:u}),L=W(h),R=W(p),D=W(g),M=W(g),w((F=t((z=function(e){function t(){for(var t,l=arguments.length,o=new Array(l),a=0;a<l;a++)o[a]=arguments[a];return t=e.call.apply(e,[this].concat(o))||this,n(i(t),"mainPlane",F,i(t)),n(i(t),"infoPlane",x,i(t)),n(i(t),"skillTop",E,i(t)),n(i(t),"skillBottom",O,i(t)),n(i(t),"skillAlready",G,i(t)),n(i(t),"cameraCom",H,i(t)),n(i(t),"PlayerDraw",U,i(t)),n(i(t),"PlayerName",j,i(t)),n(i(t),"PlayerInfo",q,i(t)),r(i(t),"animation",null),r(i(t),"_ray",new f.Ray),r(i(t),"currentPlayer",null),r(i(t),"lastPlayer",null),t}l(t,e);var a=t.prototype;return a.start=function(){this.animation=this.infoPlane.getComponent(c),this.infoPlane.getComponent(y).isAlignRight=!0,this.infoPlane.getComponent(y).isAlignLeft=!1,this.infoPlane.getComponent(y).right=-50,this.infoPlane.on(u.EventType.TOUCH_START,(function(e){})),this.onMainPlaneTouch()},a.onMainPlaneTouch=function(){var e=this,t=null;this.mainPlane.on(u.EventType.TOUCH_START,(function(l){e.currentPlayer&&(e.lastPlayer=e.currentPlayer),t=e.getFirstPlayer(l)}),this),this.mainPlane.on(u.EventType.TOUCH_END,(function(l){t&&t==e.getFirstPlayer(l)?(e.currentPlayer=t.getParent(),e.lastPlayer&&e.lastPlayer!=e.currentPlayer&&e.lastPlayer.getComponent(b).showRange(!1),e.currentPlayer.getComponent(b).showRange(!0),e.setPlayerInfo(e.currentPlayer.getComponent(b).data),e.showInfo()):e.lastPlayer?(e.lastPlayer.getComponent(b).showRange(!1),e.hideInfo()):e.hideInfo()}),this)},a.showInfo=function(){this.currentPlayer.getPosition().x>0?this.lastPlayer?(this.infoPlane.getComponent(y).isAlignRight=!1,this.infoPlane.getComponent(y).isAlignLeft=!0,this.infoPlane.getComponent(y).left=60):(this.animation.getState("left_to_right").wrapMode=1,this.animation.play("left_to_right")):this.lastPlayer?(this.infoPlane.getComponent(y).isAlignRight=!0,this.infoPlane.getComponent(y).isAlignLeft=!1,this.infoPlane.getComponent(y).right=260):(this.animation.getState("right_to_left").wrapMode=1,this.animation.play("right_to_left"))},a.hideInfo=function(){this.currentPlayer&&(this.currentPlayer.getPosition().x>0?(this.animation.getState("left_to_right").wrapMode=36,this.animation.play("left_to_right")):(this.animation.getState("right_to_left").wrapMode=36,this.animation.play("right_to_left")),this.currentPlayer=null,this.lastPlayer=null)},a.setPlayerInfo=function(e){console.log(e),this.PlayerName.string=e.label,this.PlayerInfo.string=e.description;var t=this;m.loadRemote(e.image,(function(e,l){var n=new P,i=new k;i.image=l,n.texture=i,t.PlayerDraw.spriteFrame=n})),e.skills&&e.skills.length&&(e.level||(e.level=0),2*e.level+1>=e.skills.length?(this.setSkillInfo(this.skillTop,e.skills[e.skills.length-2]),this.setSkillInfo(this.skillBottom,e.skills[e.skills.length-1])):(this.setSkillInfo(this.skillTop,e.skills[2*e.level]),this.setSkillInfo(this.skillBottom,e.skills[2*e.level+1]))),e.learned_skills||(e.learned_skills=[],e.top_skills=[0,0,0,0],e.bottom_skills=[0,0,0,0]);for(var l=0;l<e.skills.length;l++)e.skills[l].learn_type||(e.skills[l].learn_type=0),l%2==0?this.setSkillPoint(this.skillTop,e.skills[l],l/2+1):this.setSkillPoint(this.skillBottom,e.skills[l],(l-1)/2+1);for(var n=0;n<e.top_skills.length;n++)this.setSkillPoint(this.skillTop,e.top_skills[n],n+1);for(var i=0;i<e.bottom_skills.length;i++)this.setSkillPoint(this.skillBottom,e.bottom_skills[i],i+1);this.setLearnedSkillInfo(e.learned_skills)},a.setSkillInfo=function(e,t){e.getChildByName("SkillText").getComponent(g).string=t.description,e.getChildByName("UpgradeBtn").getChildByName("Label").getComponent(g).string="$"+t.price,m.loadRemote(t.image,(function(t,l){var n=new P,i=new k;i.image=l,n.texture=i,e.getChildByName("SkillIcon").getComponent(p).spriteFrame=n}))},a.setSkillPoint=function(e,t,l){var n=e.getChildByName("Skill-"+l).getComponent(p);n.color=new d(1==t?"#2BD153":-1==t?"#ff3141":"#000000")},a.setLearnedSkillInfo=function(e){for(var t,l=this,n=o(this.skillAlready.children);!(t=n()).done;){t.value.getChildByName("Sprite").getComponent(p).spriteFrame=null}for(var i=function(t){var n=l.skillAlready.children[t].getChildByName("Sprite");m.loadRemote(e[t].image,(function(e,t){var l=new P,i=new k;i.image=t,l.texture=i,n.getComponent(p).spriteFrame=l}))},r=0;r<e.length;r++)i(r)},a.updateSkill=function(e,t){var l=this.currentPlayer.getComponent(b).data,n=l.skills[2*l.level+("top"==t?0:1)];n&&(l.level>=4||v.GOLD<n.price||(n.learn_type=1,l.skills[2*l.level+("top"==t?1:0)].learn_type=-1,l.learned_skills.push(n),l.top_skills[l.level]="top"==t?1:-1,l.bottom_skills[l.level]="top"==t?-1:1,l.level+=1,v.GOLD-=n.price,v.emit(v.GOLD_CHANGE,v.GOLD),this.setPlayerInfo(l),this.setLearnedSkillInfo(l.learned_skills),this.currentPlayer.getComponent(b).updateSkill()))},a.getFirstPlayer=function(e){var t=e.touch;if(this.cameraCom.screenPointToRay(t.getLocationX(),t.getLocationY(),this._ray),_.instance.raycast(this._ray))for(var l=_.instance.raycastResults,n=0;n<l.length;n++){var i=l[n].collider;if(2==i.getGroup()&&3==i.getMask())return i.node}return null},t}(C)).prototype,"mainPlane",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),x=t(z.prototype,"infoPlane",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),E=t(z.prototype,"skillTop",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),O=t(z.prototype,"skillBottom",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),G=t(z.prototype,"skillAlready",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),H=t(z.prototype,"cameraCom",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),U=t(z.prototype,"PlayerDraw",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),j=t(z.prototype,"PlayerName",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),q=t(z.prototype,"PlayerInfo",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),N=z))||N));a._RF.pop()}}}));

System.register("chunks:///_virtual/HttpRequest.ts",["./_rollupPluginModLoBabelHelpers.js","cc"],(function(e){"use strict";var t,n;return{setters:[function(e){t=e.defineProperty},function(e){n=e.cclegacy}],execute:function(){n._RF.push({},"f5989/KQ6BMGJRhnhNuvYb4","HttpRequest",void 0);var s=e("HttpRequest",function(){function e(){}return e.POST=function(e,t){var n=this;return void 0===t&&(t={}),new Promise((function(s,a){var r=new XMLHttpRequest;r.open("POST",n.serverPath+e,!0),r.setRequestHeader("Content-type","application/json");var o=Object.assign(t,{uniIdToken:n.token});r.send(JSON.stringify(o)),r.onreadystatechange=function(){if(4==r.readyState&&200==r.status){var e=JSON.parse(r.responseText);e.data?s(e.data):s(e)}else 4==r.readyState&&200!=r.status&&a()}}))},e.SetToken=function(t){e.token=t.token},e}());t(s,"serverPath","https://5afd7a04-9817-4b73-8f96-96fba1ee24c9.bspapp.com"),t(s,"token",null),n._RF.pop()}}}));

System.register("chunks:///_virtual/GameState.ts",["./_rollupPluginModLoBabelHelpers.js","cc"],(function(e){"use strict";var t,n;return{setters:[function(e){t=e.defineProperty},function(e){n=e.cclegacy}],execute:function(){n._RF.push({},"f97b4CPJElBd6m58jXmf8rr","GameState",void 0);var r=e("GameState",(function(){}));t(r,"PAUSED","paused"),t(r,"PLAYING","playing"),t(r,"SPEED","speed"),t(r,"STATE",r.PAUSED),n._RF.pop()}}}));

System.register("chunks:///_virtual/main",["./EventCenter.ts","./GameState.ts","./GameManager.ts","./MonsterController.ts","./HttpRequest.ts","./HomeManager.ts","./Player.ts","./UIManager.ts","./BulletController.ts","./InfoManager.ts"],(function(){"use strict";return{setters:[null,null,null,null,null,null,null,null,null,null],execute:function(){}}}));

(function(r) {
  r('virtual:///prerequisite-imports/main', 'chunks:///_virtual/main'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});